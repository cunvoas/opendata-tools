<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="~{fragments/fragment-head :: head(#{cityassociation.title})}"></head>

<body class="sb-nav-fixed">
	<div th:insert="~{fragments/fragment-navUp :: navUp}"></div>
	<div id="layoutSidenav">
		<div th:insert="~{fragments/fragment-navLeft :: navLeft}"></div>

		<div id="layoutSidenav_content">
			<main>

				<div class="container-fluid">
					<!-- Header Section -->
					<div class="row mb-4 mt-4">
						<div class="col-12">
							<div class="d-flex justify-content-between align-items-center">
								<div>
									<h1 class="mb-1" th:text="#{cityassociation.title}">Association Villes - Communautés</h1>
									<p class="text-muted mb-0" th:text="#{cityassociation.subtitle}">Gestion et consultation des communautés de communes</p>
								</div>
								<div class="text-end">
									<small class="text-muted" id="recordCount"></small>
								</div>
							</div>
						</div>
					</div>

					<!-- Filters Section -->
					<div class="row mb-4" th:if="${isAdmin}">
						<div class="col-12">
							<div class="card border-0 shadow-sm">
								<div class="card-body">
									<div class="row g-3">
										<!-- Region Filter -->
										<div class="col-md-6">
											<div class="d-flex align-items-center h-100">
												<form th:action="@{/mvc/management/cityassoc/list}" method="get" onchange="submit();" class="w-100">
													<div class="form-floating">
														<select class="form-select" id="regionFilter" name="regionId" onchange="filterByRegion()">
															<option value="" th:selected="${selectedRegionId == null}" th:text="#{cityassociation.filter.allregions}">Toutes les régions</option>
															<option th:each="region : ${regions}" 
																	th:value="${region.id}" 
																	th:text="${region.name}"
																	th:selected="${selectedRegionId != null && selectedRegionId == region.id}"></option>
														</select>
														<label for="regionFilter"><i class="fas fa-map me-2"></i><span th:text="#{cityassociation.filter.region}">Filtrer par région</span></label>
													</div>
												</form>
											</div>
										</div>
										
										<!-- Manage Association Link -->
										<div class="col-md-6">
											<div class="d-flex align-items-center h-100 justify-content-end">
												<a th:href="@{/mvc/management/cityassoc/edit}" class="btn btn-primary">
													<i class="fas fa-plus me-2"></i><span th:text="#{cityassociation.manage}">Gérer les associations</span>
												</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Table Section -->
					<div class="row">
						<div class="col-12">
							<div class="card border-0 shadow-sm">
								<div class="card-header bg-gradient text-white py-3">
									<h5 class="mb-0"><i class="fas fa-list-ul me-2"></i><span th:text="#{cityassociation.table.title}">Communautés de Communes</span></h5>
								</div>
								<div class="card-body p-0">
									<div class="table-responsive">
										<table class="table table-hover mb-0" id="datatablesSimple">
											<thead class="table-light">
												<tr>
													<th class="text-nowrap"><i class="fas fa-building me-1 text-muted"></i><span th:text="#{cityassociation.table.name}">Nom</span></th>
													<th class="text-nowrap"><i class="fas fa-map me-1 text-muted"></i><span th:text="#{cityassociation.table.region}">Région</span></th>
													<th class="text-center text-nowrap"><i class="fas fa-city me-1 text-muted"></i><span th:text="#{cityassociation.table.citycount}">Nombre de villes</span></th>
													<th class="text-center text-nowrap"><i class="fas fa-link me-1 text-muted"></i><span th:text="#{cityassociation.table.link}">Action</span></th>
												</tr>
											</thead>
											<tbody>
												<tr th:each="comm2co : ${listCityAssociation}" class="align-middle">
													<td>
														<strong th:text="${comm2co.name}"></strong>
													</td>
													<td>
														<span class="badge bg-light text-dark" th:text="${comm2co.region != null ? comm2co.region.name : 'N/A'}"></span>
													</td>
													<td class="text-center">
														<span class="badge bg-info text-white" th:text="${comm2co.cities != null ? comm2co.cities.size() : 0}"></span>
													</td>
													<td class="text-center">
														<a th:href="@{/mvc/management/cityassoc/edit?communauteCommuneId={id}(id=${comm2co.id})}" class="btn btn-sm btn-outline-primary" th:title="#{cityassociation.table.link}" title="Gérer">
															<i class="fas fa-edit"></i>
														</a>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

							
			</main>
		</div> <!-- layoutSidenav_content -->
	</div> <!-- layoutSidenav -->
	

	<div th:insert="~{fragments/fragment-footer :: footer}"></div>

     <div th:insert="~{fragments/fragment-jslibs :: appPage}"></div>

	<script th:src="@{/mvc/static/js/scripts.js}"></script>
	<style>
		/* Custom styles for enhanced design */
		.bg-gradient {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		}

		.card {
			transition: all 0.3s ease-in-out;
		}

		.card:hover {
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
		}

		.table-hover tbody tr:hover {
			background-color: #f8f9fa;
		}

		.btn-group-sm .btn {
			padding: 0.25rem 0.5rem;
			font-size: 0.875rem;
		}
	</style>

	<script th:inline="javascript">
	    window.addEventListener('DOMContentLoaded', event => {
	        // Simple-DataTables
	        // https://github.com/fiduswriter/Simple-DataTables/wiki
	
	        const datatablesSimple = document.getElementById('datatablesSimple');
	        if (datatablesSimple) {
	            new simpleDatatables.DataTable(datatablesSimple);
	        }
	        
	        // Update record count
	        updateRecordCount();
	    });
	    
	    function filterByRegion() {
	        const regionId = document.getElementById('regionFilter').value;
	        if (regionId) {
	            window.location.href = [[@{/mvc/management/cityassoc/list}]] + '?regionId=' + regionId;
	        } else {
	            window.location.href = [[@{/mvc/management/cityassoc/list}]];
	        }
	    }
	    
	    function updateRecordCount() {
	        const table = document.getElementById('datatablesSimple');
	        if (table && table.tbody) {
	            const count = table.querySelectorAll('tbody tr').length;
	            document.getElementById('recordCount').textContent = count + ' enregistrement(s)';
	        }
	    }
	</script>
</body>
</html>
